# ADR 003: Activity Logging Choice â€” Spatie Laravel Activitylog

**Date**: 2025-10-08  
**Status**: Accepted  
**Decision Makers**: Development Team  

## Context

The application requires comprehensive audit logging for compliance, security, and troubleshooting:
- Track create/update/delete operations on core models (Cases, Hearings, Documents, Clients, etc.)
- Record who performed the action (`causer_id`)
- Capture additional context (IP address, User-Agent, timestamp)
- Support querying activity history
- Provide admin-accessible activity feed
- Minimal performance overhead

## Decision

We will use **Spatie Laravel Activitylog** package for audit trail implementation.

## Rationale

1. **Ease of Integration**: Simple trait-based activation on models
2. **Rich Context**: Captures model changes, old/new values, causer, custom properties
3. **Flexibility**: Supports logging custom events beyond model events
4. **Performance**: Async/queue support for high-traffic scenarios
5. **Query Interface**: Eloquent-based activity retrieval
6. **Model Relationships**: Direct relationship between models and their activities
7. **Spatie Ecosystem**: Works well with Spatie Permission (same vendor, consistent APIs)

## Consequences

### Positive
- Automatic logging with minimal code (`LogsActivity` trait)
- Detailed change tracking (before/after snapshots)
- Custom property logging (e.g., IP, User-Agent)
- Admin can view full audit trail per entity
- Supports filtering by causer, date range, model type

### Negative
- Adds `activity_log` table that grows over time (requires archival strategy)
- Minor performance overhead on write operations
- Needs configuration for which attributes to log

## Implementation Plan

1. Publish configuration and migration
2. Add `LogsActivity` trait to core models:
   - `Case`, `Hearing`, `Client`, `Document`, `EngagementLetter`, `PowerOfAttorney`, `AdminTask`, `AdminSubtask`
3. Configure logged attributes per model
4. Create custom log properties helper for IP/User-Agent
5. Build admin activity feed view (filterable, paginated)
6. Implement log retention policy (e.g., archive logs older than 2 years)

## Alternatives Considered

1. **Custom Activity Log**: More development effort, potential bugs
2. **Laravel's Built-in Events**: Requires manual logging code in each listener
3. **Other Packages** (Laravel Auditing, owen-it/laravel-auditing): Similar features, less adoption

## References

- Spatie Activitylog Documentation: https://spatie.be/docs/laravel-activitylog
- Project Requirements: Master Prompt T-06, NFRs (Security, Reliability)

