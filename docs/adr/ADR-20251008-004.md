# ADR 004: Internationalization (i18n) Scheme â€” Language Files + Middleware

**Date**: 2025-10-08  
**Status**: Accepted  
**Decision Makers**: Development Team  

## Context

The application must support bilingual operation (English and Arabic) with:
- User-selectable language preference
- Right-to-left (RTL) layout for Arabic
- Localized date, time, and currency formatting
- Translation of all UI strings, validation messages, notifications
- Persistence of user language preference
- Default locale: English (en), Fallback: Arabic (ar)
- Timezone: Africa/Cairo

## Decision

We will use **Laravel's built-in language files** (`resources/lang/{locale}/*.php`) combined with **custom middleware** for locale switching and persistence.

## Rationale

1. **Native Laravel Support**: No additional packages required for basic i18n
2. **File-Based Translations**: Easy to version control, review, and edit
3. **Flexibility**: Supports nested keys, pluralization, parameter replacement
4. **Performance**: Translations are cached and loaded efficiently
5. **Blade Integration**: `{{ __('key') }}` and `@lang('key')` directives
6. **Validation Messages**: Laravel validates in selected locale automatically

## Implementation Details

### Directory Structure
```
resources/
  lang/
    en/
      auth.php
      validation.php
      messages.php
      cases.php
      hearings.php
      clients.php
      ...
    ar/
      auth.php
      validation.php
      messages.php
      cases.php
      hearings.php
      clients.php
      ...
```

### Locale Middleware
- Check for `locale` query parameter or session value
- Fall back to user's stored preference (DB column: `users.locale`)
- Set `app()->setLocale($locale)`
- Store locale in session for current request lifecycle
- Share `$isRTL` variable with all views (`RTL = ar`)

### Configuration
- `.env`: `APP_LOCALE=en`, `APP_FALLBACK_LOCALE=ar`, `APP_TIMEZONE=Africa/Cairo`
- `config/app.php`: Add `'locales' => ['en', 'ar']`

### RTL Support
- Conditional CSS class on `<html>` or `<body>`: `dir="{{ app()->getLocale() === 'ar' ? 'rtl' : 'ltr' }}"`
- Bootstrap RTL build or custom RTL stylesheet
- Blade directive: `@if(app()->getLocale() === 'ar') rtl-class @endif`

### Date/Time Formatting
- Use Carbon with locale setting: `Carbon::setLocale(app()->getLocale())`
- Blade helper: `{{ formatDate($date) }}` (custom helper respecting locale)
- Timezone set globally to `Africa/Cairo`

## Consequences

### Positive
- Full control over translation keys and structure
- Easy to maintain synchronized EN/AR files
- No external dependencies
- Lightweight and performant
- Supports dynamic locale switching

### Negative
- Manual translation file management (must keep EN/AR in sync)
- Requires discipline to avoid hardcoded strings
- RTL CSS requires additional effort

## Alternatives Considered

1. **Database-Based Translations** (e.g., spatie/laravel-translation-loader): Overkill, harder to version control
2. **GetText (.po files)**: More complex, not Laravel-native
3. **Third-Party Services** (Phrase, Lokalise): Unnecessary for two languages

## References

- Laravel Localization: https://laravel.com/docs/10.x/localization
- Bootstrap RTL: https://getbootstrap.com/docs/5.3/getting-started/rtl/
- Project Requirements: Master Prompt T-08, NFRs (Usability)

